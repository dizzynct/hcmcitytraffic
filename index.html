<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ảnh Giao Thông TP.HCM</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .image-gallery {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 1px;
        }
        .image-gallery img {
            width: 100%;
            height: auto;
        }
		.camera-container {
            border-radius: 0.1px;
            border: 0px solid black;
        }
        .camera-info {
            text-align: center;
			vertical-align: bottom;			
        }
        .camera-description {
            font-size: 8px;
            color: #555;
        }
        .camera-location {
            font-size: 12px;
            color: #777;
        }
		.timer {
      position: fixed;
      padding: 2px;
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      font-size: 8px;
      border-radius: 1px;
      font-weight: bold;
	  z-index: 9999; 
    }
    </style>
</head>
<body>
	<div class="timer" id="timer">10s</div>
    <div class="image-gallery" id="imageGallery"></div>
    <!-- Dữ liệu JSON tích hợp trực tiếp vào trong thẻ <script> -->
    <script>
        const cameraData = {
	"cameras": [		
    {
      "id": "5a8279865058170011f6eaef",
      "description": "Nguyễn Văn Linh - Phạm Hùng 2",
      "location": "Bình Chánh, TP.HCM"
    },
	{
      "id": "5875d4f8b807da0011e33d1a",
      "description": "Tạ Quang Bửu - Phạm Hùng",
      "location": "Quận 8, TP.HCM"
    },	
    {
      "id": "58744fb0b807da0011e33cc0",
      "description": "Cầu Chánh Hương",
      "location": "Quận 8, TP.HCM"
    },
    {
      "id": "56de42f611f398ec0c48128e",
      "description": "Võ Văn Kiệt - Cầu Chữ Y",
      "location": "Quận 5, TP.HCM"
    },
	{
      "id": "649da72ca6068200171a6dbb",
      "description": "Tôn Đức Thắng - Hàm Nghi",
      "location": "Quận 1, TP.HCM"
    },
    {
      "id": "649da77ea6068200171a6dd4",
      "description": "Công Trường Mê Linh",
      "location": "Quận 1, TP.HCM"
    },
    {
      "id": "5a606dbc8576340017d0662b",
      "description": "Điện Biên Phủ - Nguyễn Hữu Cảnh",
      "location": "Quận Bình Thạnh, TP.HCM"
    },
    {
      "id": "6623f5b56f998a001b25292f",
      "description": "Xa Lộ Hà Nội",
      "location": "Quận 2, TP.HCM"
    },
	{
      "id": "583f976361cfea0012cf68f9",
      "description": "Nguyễn Thị Định - Lê Phụng Hiểu",
      "location": "Quận 9, TP.HCM"
    },
    {
      "id": "63b548c3bfd3d90017ea77c0",
      "description": "Nguyễn Duy Trinh - Nguyễn Thị Tư",
      "location": "Quận 9, TP.HCM"
    },
    {
      "id": "63b54dcbbfd3d90017ea7ba8",
      "description": "Quốc Lộ 1 - Cổng ĐH Quốc gia TPHCM",
      "location": "Quận 9, TP.HCM"
    },
    {
      "id": "5a6065c58576340017d06615",
      "description": "Tô Ngọc Vân - TX25",
      "location": "Thủ Đức, TP.HCM"
    },
    {
      "id": "6623efc26f998a001b25277f",
      "description": "Tô Ký - Nguyễn Ảnh Thủ",
      "location": "Quận 12, TP.HCM"
    },
    {
      "id": "662a88a01afb9c00172d25d1",
      "description": "Trần Văn Giàu - Đường Thanh Niên",
      "location": "Bình Tân, TP.HCM"
    },
    {
      "id": "63b664edbfd3d90017eaaa24",
      "description": "CT Trung Lương - Võ Trần Chí 2",
      "location": "Bình Chánh, TP.HCM"
    },
    {
      "id": "5a825ded5058170011f6ead7",
      "description": "Quốc lộ 50 - Cầu Ông Thìn (2)",
      "location": "Bình Chánh, TP.HCM"
    },
    {
      "id": "662a861e1afb9c00172d23ad",
      "description": "Nguyễn Hữu Thọ - Phạm Hữu Lầu",
      "location": "Quận 7, TP.HCM"
    },    
    {
      "id": "63bd1f21bfd3d90017ec3d04",
      "description": "Huỳnh Tấn Phát - Phạm Hữu Lầu",
      "location": "Nhà Bè, TP.HCM"
    },
    {
      "id": "662a8ddd1afb9c00172d2a0f",
      "description": "Nguyễn Văn Linh - cầu Tân Thuận 2",
      "location": "Quận 7, TP.HCM"
    },
    {
      "id": "63ae777cbfd3d90017e8f177",
      "description": "Nguyễn Tất Thành - Đoàn Như Hài",
      "location": "Quận 4, TP.HCM"
    },
    {
      "id": "586e1f18f9fab7001111b0a5",
      "description": "Cộng Hòa - Trường Chinh",
      "location": "Tân Bình, TP.HCM"
    },
    {
      "id": "587478d8b807da0011e33cf3",
      "description": "Nút giao Bảy Hiền CMT8",
      "location": "Tân Bình, TP.HCM"
    },
    {
      "id": "5deb576d1dc17d7c5515acf9",
      "description": "Công Trường Dân Chủ",
      "location": "Quận 1, TP.HCM"
    },
	{
      "id": "5deb576d1dc17d7c5515ad05",
      "description": "Điện Biên Phủ - Đinh Tiên Hoàng",
      "location": "Quận 1, TP.HCM"
    },
    {
      "id": "63b54d27bfd3d90017ea7ae5",
      "description": "Xa lộ Hà Nội - Đường D1",
      "location": "Thủ Đức, TP.HCM"
    },
    {
      "id": "56de42f611f398ec0c48127e",
      "description": "Mai Chí Thọ - Võ Nguyên Giáp (Cát Lái cầu B)",
      "location": "Thử Đức, TP.HCM"
    },
    {
      "id": "5a10c79f02eb490011a0b0dd",
      "description": "Mai Chí Thọ - Tố Hữu (C6)",
      "location": "Thủ Đức, TP.HCM"
    },
    {
      "id": "662b862a1afb9c00172dd1ff",
      "description": "Hàm Nghi - Phó Đức Chính",
      "location": "Quận 1, TP.HCM"
    },
    {
      "id": "5deb576d1dc17d7c5515acf7",
      "description": "Ngã sáu Cộng Hòa",
      "location": "Quận 3, TP.HCM"
    },
    {
      "id": "5deb576d1dc17d7c5515acf3",
      "description": "Ba Tháng Hai - Lý Thái Tổ",
      "location": "Quận 10, TP.HCM"
    },
    {
      "id": "63ae7be0bfd3d90017e8f3a8",
      "description": "Ba Tháng Hai - Lê Đại Hành 1",
      "location": "Quận 10, TP.HCM"
    },
    {
      "id": "66b1c311779f740018674083",
      "description": "Vòng xoay Phú Lâm (1)",
      "location": "Quận 6, TP.HCM"
    },
    {
      "id": "662a881a1afb9c00172d2559",
      "description": "Kinh Dương Vương - Tên Lửa",
      "location": "Quận 6, TP.HCM"
    },
    {
      "id": "6792f16e8c5ed4001b27f482",
      "description": "Cao tốc LT-DG - Trạm thu phí Long Phước",
      "location": "Quận 9, TP.HCM"
    },
    {
      "id": "5a8257e25058170011f6eacd",
      "description": "Hoàng Hữu Nam - Đường D400",
      "location": "Quận 9, TP.HCM"
    },
    {
      "id": "6792f1008c5ed4001b27f41f",
      "description": "Quốc Lộ 22 - Võ Văn Điều",
      "location": "Củ Chi, TP.HCM"
    },
    {
      "id": "6792ef4f8c5ed4001b27f2c0",
      "description": "Quốc Lộ 1 - Ba Làng",
      "location": "Bình Chánh, TP.HCM"
    },
    {
      "id": "6792f03d8c5ed4001b27f378",
      "description": "Quốc Lộ 50 - Cổng chào Long An",
      "location": "Bình Chánh, TP.HCM"
    },
    {
      "id": "5a8269c45058170011f6eae4",
      "description": "Nguyễn Văn Quỳ - Cầu Phú Mỹ",
      "location": "Quận 7, TP.HCM"
    },
	{
      "id": "56de42f611f398ec0c4812a2",
      "description": "Nút giao Mỹ Thủy",
      "location": "Quận 7, TP.HCM"
    }
	
]};


		var rotator = -1;
		document.addEventListener('keydown', function(event) {
		  // Kiểm tra nếu phím được nhấn là Space (mã 32 hoặc key === ' ')
		  if (event.code === 'Space') {
			if (rotator > 0) {
				clearInterval(rotator);
				rotator = -1;
		  } else {
				rotator = setInterval(async () => { countdown();}, 1000);
		  }
		  }
		});

        // Hàm để hiển thị ảnh và thông tin camera
        function loadImages(cameras) {
            const gallery = document.getElementById('imageGallery');
            gallery.innerHTML = ''; // Xóa tất cả ảnh cũ

            cameras.forEach(camera => {
				var timestamp = new Date().getTime();
                // Tạo phần tử hình ảnh
                const imgElement = document.createElement('img');				
                imgElement.src = "https://giaothong.hochiminhcity.gov.vn:8007/Render/CameraHandler.ashx?id="+camera.id+"&t="+ timestamp;
                imgElement.alt = `Camera ID: ${camera.id}`;

                // Tạo phần tử thông tin camera
                const infoElement = document.createElement('div');
                infoElement.classList.add('camera-info');
                const descriptionElement = document.createElement('p');
                descriptionElement.classList.add('camera-description');
                descriptionElement.textContent = camera.description;
				infoElement.appendChild(descriptionElement);
				
                //const locationElement = document.createElement('p');
                //locationElement.classList.add('camera-location');
                //locationElement.textContent = `Vị trí: ${camera.location}`;                
                //infoElement.appendChild(locationElement);

                // Tạo một container chứa ảnh và thông tin
                const cameraContainer = document.createElement('div');
				cameraContainer.classList.add('camera-container');
                cameraContainer.appendChild(infoElement);
				cameraContainer.appendChild(imgElement);                

                // Thêm vào gallery
                gallery.appendChild(cameraContainer);
            });
        }

		// Hàm tự động tải lại ảnh sau mỗi 10 giây
        async function autoReload() {
            loadImages(cameraData.cameras);
			
            //setInterval(async () => { loadImages(cameraData.cameras);}, 10000); // Tải lại ảnh sau mỗi 10 giây			
			//rotator = setInterval(async () => { countdown();}, 1000);
        }

        // Bắt đầu tải ảnh khi trang được tải
        window.onload = autoReload;

		let timeLeft = 10;

		function countdown() {
		  if (timeLeft > 0) {
			timeLeft--;
			document.getElementById("timer").textContent = timeLeft + "s";
		  } else {
			timeLeft = 10;
			loadImages(cameraData.cameras);
		  }
		}

    </script>
</body>
</html>
